<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 800 800"
   version="1.1"
   id="svg25"
   sodipodi:docname="llm-residual-stream.svg"
   inkscape:version="1.4 (e7c3feb100, 2024-10-09)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview25"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="1.0556989"
     inkscape:cx="38.363211"
     inkscape:cy="57.308006"
     inkscape:window-width="1504"
     inkscape:window-height="852"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="0"
     inkscape:current-layer="svg25" />
  <!-- Background -->
  <!-- Input Tokens -->
  <rect
     x="50"
     y="50"
     width="700"
     height="60"
     rx="8"
     ry="8"
     fill="#e9ecef"
     stroke="#ced4da"
     stroke-width="2"
     id="rect2" />
  <!-- Token examples -->
  <rect
     x="80"
     y="65"
     width="60"
     height="30"
     rx="4"
     ry="4"
     fill="#4dabf7"
     stroke="#339af0"
     stroke-width="1"
     id="rect3" />
  <text
     x="110"
     y="85"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="white"
     id="text3">&quot;The&quot;</text>
  <rect
     x="150"
     y="65"
     width="60"
     height="30"
     rx="4"
     ry="4"
     fill="#4dabf7"
     stroke="#339af0"
     stroke-width="1"
     id="rect4" />
  <text
     x="180"
     y="85"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="white"
     id="text4">&quot;cat&quot;</text>
  <rect
     x="220"
     y="65"
     width="60"
     height="30"
     rx="4"
     ry="4"
     fill="#4dabf7"
     stroke="#339af0"
     stroke-width="1"
     id="rect5" />
  <text
     x="250"
     y="85"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="white"
     id="text5">&quot;sat&quot;</text>
  <rect
     x="290"
     y="65"
     width="60"
     height="30"
     rx="4"
     ry="4"
     fill="#4dabf7"
     stroke="#339af0"
     stroke-width="1"
     id="rect6" />
  <text
     x="320"
     y="85"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="white"
     id="text6">&quot;on&quot;</text>
  <rect
     x="360"
     y="65"
     width="60"
     height="30"
     rx="4"
     ry="4"
     fill="#4dabf7"
     stroke="#339af0"
     stroke-width="1"
     id="rect7" />
  <text
     x="390"
     y="85"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="white"
     id="text7">&quot;the&quot;</text>
  <!-- Arrows from Tokens to Embeddings -->
  <path
     d="M110 95 L110 120 L200 140"
     stroke="#495057"
     stroke-width="2"
     stroke-dasharray="5,3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path7" />
  <path
     d="M180 95 L180 125 L250 140"
     stroke="#495057"
     stroke-width="2"
     stroke-dasharray="5,3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path8" />
  <path
     d="M250 95 L250 130 L300 140"
     stroke="#495057"
     stroke-width="2"
     stroke-dasharray="5,3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path9" />
  <path
     d="M320 95 L320 125 L350 140"
     stroke="#495057"
     stroke-width="2"
     stroke-dasharray="5,3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path10" />
  <path
     d="M390 95 L390 120 L400 140"
     stroke="#495057"
     stroke-width="2"
     stroke-dasharray="5,3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path11" />
  <!-- Initial Embeddings -->
  <rect
     x="200"
     y="140"
     width="400"
     height="30"
     rx="4"
     ry="4"
     fill="#a5d8ff"
     stroke="#1c7ed6"
     stroke-width="2"
     id="rect11" />
  <text
     x="400"
     y="160"
     text-anchor="middle"
     font-family="Arial"
     font-size="14"
     fill="#1c7ed6"
     id="text11">Embeddings</text>
  <!-- Vertical Residual Stream -->
  <line
     x1="400"
     y1="170.8432"
     x2="400"
     y2="750"
     stroke="#ff922b"
     stroke-width="5.99564"
     stroke-dasharray="none"
     id="line11" />
  <text
     x="420"
     y="186"
     text-anchor="start"
     font-family="Arial"
     font-size="14px"
     font-weight="bold"
     fill="#e8590c"
     id="text12">Residual Stream</text>
  <!-- Layer 1 -->
  <rect
     x="200"
     y="300"
     width="150"
     height="60"
     rx="8"
     ry="8"
     fill="#1c7ed6"
     stroke="#1864ab"
     stroke-width="2"
     id="rect12" />
  <text
     x="275"
     y="335"
     text-anchor="middle"
     font-family="Arial"
     font-size="16"
     font-weight="bold"
     fill="white"
     id="text13">Layer 1</text>
  <!-- Layer 1 Read from Residual Stream -->
  <path
     d="M 397.0488,220 H 275 v 76"
     stroke="#4dabf7"
     stroke-width="3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path13"
     sodipodi:nodetypes="ccc" />
  <text
     x="340"
     y="215"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="#1c7ed6"
     id="text14">Read</text>
  <!-- Layer 1 Write to Residual Stream -->
  <path
     d="m 275,360 v 30 h 113"
     stroke="#ff922b"
     stroke-width="3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path14"
     sodipodi:nodetypes="ccc" />
  <text
     x="340"
     y="385"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="#e8590c"
     id="text15">Add</text>
  <!-- Addition Symbol at Layer 1 -->
  <circle
     cx="400"
     cy="390"
     r="10"
     fill="#fff"
     stroke="#ff922b"
     stroke-width="2"
     id="circle15" />
  <line
     x1="390"
     y1="390"
     x2="410"
     y2="390"
     stroke="#ff922b"
     stroke-width="2"
     id="line15" />
  <line
     x1="400"
     y1="380"
     x2="400"
     y2="400"
     stroke="#ff922b"
     stroke-width="2"
     id="line16" />
  <!-- Layer 1 Activation Measurement -->
  <rect
     x="450.11588"
     y="390.11588"
     width="76.75061"
     height="19.768244"
     rx="6.140049"
     ry="3.9536486"
     fill="#ffe066"
     stroke="#f08c00"
     stroke-width="1.23176"
     id="rect16" />
  <text
     x="487.22638"
     y="406.6864"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     id="text16"
     style="font-size:18.6667px">Measure</text>
  <line
     x1="400"
     y1="400"
     x2="450"
     y2="400"
     stroke="#f08c00"
     stroke-width="2"
     id="line17" />
  <!-- Layer 2 -->
  <rect
     x="200"
     y="450"
     width="150"
     height="60"
     rx="8"
     ry="8"
     fill="#1c7ed6"
     stroke="#1864ab"
     stroke-width="2"
     id="rect17" />
  <text
     x="275"
     y="485"
     text-anchor="middle"
     font-family="Arial"
     font-size="16"
     font-weight="bold"
     fill="white"
     id="text17">Layer 2</text>
  <!-- Layer 2 Read from Residual Stream -->
  <path
     d="M 396.8432,414 H 275 v 32"
     stroke="#4dabf7"
     stroke-width="3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path17"
     sodipodi:nodetypes="ccc" />
  <text
     x="340"
     y="411"
     text-anchor="middle"
     font-family="Arial"
     font-size="12px"
     fill="#1c7ed6"
     id="text18">Read</text>
  <!-- Layer 2 Write to Residual Stream -->
  <path
     d="m 275,510 v 30 h 113"
     stroke="#ff922b"
     stroke-width="3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path18"
     sodipodi:nodetypes="ccc" />
  <text
     x="340"
     y="535"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="#e8590c"
     id="text19">Add</text>
  <!-- Addition Symbol at Layer 2 -->
  <circle
     cx="400"
     cy="540"
     r="10"
     fill="#fff"
     stroke="#ff922b"
     stroke-width="2"
     id="circle19" />
  <line
     x1="390"
     y1="540"
     x2="410"
     y2="540"
     stroke="#ff922b"
     stroke-width="2"
     id="line19" />
  <line
     x1="400"
     y1="530"
     x2="400"
     y2="550"
     stroke="#ff922b"
     stroke-width="2"
     id="line20" />
  <!-- Layer 2 Activation Measurement -->
  <rect
     x="450.10934"
     y="540.10931"
     width="75.077309"
     height="19.781342"
     rx="6.0061851"
     ry="3.9562681"
     fill="#ffe066"
     stroke="#f08c00"
     stroke-width="1.21866"
     id="rect20" />
  <text
     x="487"
     y="557"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     id="text20"
     style="font-size:18.6667px">Measure</text>
  <line
     x1="400"
     y1="550"
     x2="450"
     y2="550"
     stroke="#f08c00"
     stroke-width="2"
     id="line21" />
  <!-- Layer 3 -->
  <rect
     x="200"
     y="600"
     width="150"
     height="60"
     rx="8"
     ry="8"
     fill="#1c7ed6"
     stroke="#1864ab"
     stroke-width="2"
     id="rect21" />
  <text
     x="275"
     y="635"
     text-anchor="middle"
     font-family="Arial"
     font-size="16"
     font-weight="bold"
     fill="white"
     id="text21">Layer 3</text>
  <!-- Layer 3 Read from Residual Stream -->
  <path
     d="M 397.0488,564 H 275 v 32"
     stroke="#4dabf7"
     stroke-width="3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path21"
     sodipodi:nodetypes="ccc" />
  <text
     x="340"
     y="561"
     text-anchor="middle"
     font-family="Arial"
     font-size="12px"
     fill="#1c7ed6"
     id="text22">Read</text>
  <!-- Layer 3 Write to Residual Stream -->
  <path
     d="m 275,660 v 30 h 113"
     stroke="#ff922b"
     stroke-width="3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path22"
     sodipodi:nodetypes="ccc" />
  <text
     x="340"
     y="685"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     fill="#e8590c"
     id="text23">Add</text>
  <!-- Addition Symbol at Layer 3 -->
  <circle
     cx="400"
     cy="690"
     r="10"
     fill="#fff"
     stroke="#ff922b"
     stroke-width="2"
     id="circle23" />
  <line
     x1="390"
     y1="690"
     x2="410"
     y2="690"
     stroke="#ff922b"
     stroke-width="2"
     id="line23" />
  <line
     x1="400"
     y1="680"
     x2="400"
     y2="700"
     stroke="#ff922b"
     stroke-width="2"
     id="line24" />
  <!-- Layer 3 Activation Measurement -->
  <rect
     x="450.10602"
     y="690.10602"
     width="74.240715"
     height="19.787947"
     rx="5.9392576"
     ry="3.9575894"
     fill="#ffe066"
     stroke="#f08c00"
     stroke-width="1.21205"
     id="rect24" />
  <text
     x="487"
     y="707"
     text-anchor="middle"
     font-family="Arial"
     font-size="12"
     id="text24"
     style="font-size:18.6667px">Measure</text>
  <line
     x1="400"
     y1="700"
     x2="450"
     y2="700"
     stroke="#f08c00"
     stroke-width="2"
     id="line25" />
  <!-- Output -->
  <rect
     x="450"
     y="728"
     width="150"
     height="40"
     rx="8"
     ry="8"
     fill="#51cf66"
     stroke="#40c057"
     stroke-width="2"
     id="rect25" />
  <text
     x="525"
     y="755"
     text-anchor="middle"
     font-family="Arial"
     font-size="14px"
     font-weight="bold"
     fill="#ffffff"
     id="text25">Output</text>
  <path
     d="m 398,750 h 50"
     stroke="#495057"
     stroke-width="3"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path25" />
  <!-- Arrow Definitions -->
  <defs
     id="defs25">
    <marker
       id="arrowhead"
       markerWidth="10"
       markerHeight="7"
       refX="9"
       refY="3.5"
       orient="auto">
      <polygon
         points="0 0, 10 3.5, 0 7"
         fill="#212529"
         id="polygon25" />
    </marker>
  </defs>
</svg>
